!function(a){var b=function(b){if(this._config={container:null,classes:null,onClick:null,onFocus:null,heightRatio:1},a.extend(this._config,b),null===this._config.container||this._config.container.size()<=0)throw new Error("Element not found");var c=this;this.SPACE_BETWEEN_ELEMENTS=.75,this.FOCUS_TRANSLATION=1,this.TEMPLATE='<div class="tdvp"><div class="template-element"><div class="front applyHeight"><div class="image"></div><div class="applyHeight"><div class="mirror"></div><div class="shadow"></div></div></div><div class="back applyHeight"><span class="fa fa-cloud-download"></span></div></div></div><div class="tdlabel"><div class="label-overflow"></div></div>',this._original=this._config.container,this._templateElement=null,this._vp=null,this._cont=null,this._build(),this._heightRatio=this._config.heightRatio,this._clabel=this._cont.find(".tdlabel"),this._labelOverflow=this._clabel.find(".label-overflow"),this._elements=this._vp.find(".element"),this._elemWidth=null,this._contWidth=null,this._circleStep=null,this._radius=null,this._nElem=null;var d=null;a(window).on("resize.tdGal",function(){d&&clearTimeout(d),d=setTimeout(function(){c._onWinResize()},200)}),this._setDefaultFocus(),this._compileLabels(),this.update()};b.prototype._build=function(){var b=[];this._original.find("li").each(function(){var c=a(this),d=c.find("a"),e=d.attr("href");("javascript:"===e.toLowerCase()||"#"===e)&&(e=null),b.push({link:e,image:c.find("img").attr("src"),label:d.attr("title")||c.data("label")})});var c=a(this.TEMPLATE);this._templateElement=c.find(".template-element"),this._cont=a("<div />").attr("class",this._config.classes).addClass("tdgal").html(c);var d=this._original.contents();this._original.html(this._cont),this._original=d,this._vp=this._cont.find(".tdvp:first-child");for(var e=0;e<b.length;e++)this._updateElement(b[e])},b.prototype._updateElement=function(b,c){if(!c){c=this._templateElement.clone();var d=this;c.on("click.tdGal",function(){d._onElementClick(a(this))}),this._vp.append(c)}c.find(".mirror,.image").css({"background-image":"url("+b.image+")"}),b.link?(c.data("link",b.link),c.addClass("link")):(c.data("link",null),c.removeClass("link")),c.data("label",b.label?b.label:"").data("data",b).removeClass("template-element").addClass("element")},b.prototype._setDefaultFocus=function(){this._vp.find(".element.focus").size()<=0&&this._elements.eq(0).addClass("focus")},b.prototype.setElements=function(a){for(var b=a.length,c=0;b>c;c++){var d=this._elements.eq(c);this._updateElement(a[c],d.size()?d:null)}for(var c=b;c<this._nElem;c++)this._elements.eq(c).remove();this._elements=this._vp.find(".element"),this._setDefaultFocus(),this._compileLabels(),this.update()},b.prototype._updateSizes=function(){this._elemWidth=this._elements.first().width(),this._contWidth=this._cont.width();var a=this._elemWidth*this._heightRatio;this._elements.height(a).find(".applyHeight").height(a),this._cont.height(a+this._clabel.outerHeight(!0)),this._nElem=this._elements.size();var b=this._nElem<=2?3:this._nElem,c=Math.round(this._elemWidth/2/Math.tan(Math.PI/b)),d=Math.floor(this._contWidth/this._elemWidth);this._radius=Math.round(d*this._elemWidth*this.SPACE_BETWEEN_ELEMENTS/2/Math.tan(Math.PI/b)),this._circleStep=c/this._radius*(360/b);var e=this._labelOverflow.find(".text");e.width(this._contWidth),this._labelOverflow.width(e.size()*this._contWidth)},b.prototype._calculate=function(){var a=this._radius+this._elemWidth*this.FOCUS_TRANSLATION;this._vp.css({transform:"translateZ(-"+a+"px) translateX("+(this._contWidth/2-this._elemWidth/2)+"px)"});for(var b=0,c=0;c<this._nElem;c++)if(this._elements.eq(c).hasClass("focus")){b=c;break}for(var c=0;b>c;c++)this._elements.eq(c).css({transform:"rotateY(-"+this._circleStep*(b-c)+"deg) translateZ("+this._radius+"px) rotateY(60deg)"});this._elements.eq(b).css({transform:"rotateY(0deg) translateZ("+a+"px)"});for(var c=b+1;c<this._nElem;c++)this._elements.eq(c).css({transform:"rotateY("+this._circleStep*(c-b)+"deg) translateZ("+this._radius+"px) rotateY(-60deg)"})},b.prototype.update=function(){this._updateSizes(),this._calculate()},b.prototype._compileLabels=function(){for(var b=this._clabel.find(".text"),c=b.size()-1,d=this._elements.size(),e=0;d>e;e++){var f=null;e>c?(f=a('<div class="text" />'),this._labelOverflow.append(f)):f=b.eq(e);var g=this._elements.eq(e).data("label");!g||g.length<=0?f.html("&nbsp;"):f.text(g)}for(var e=d;c>=e;e++)b.eq(e).remove()},b.prototype._displayTag=function(a){this._labelOverflow.css({transform:"translateX(-"+this._contWidth*a+"px)"})},b.prototype._onElementClick=function(a){return a.hasClass("focus")?void(this._config.onClick&&a.data("link")&&this._config.onClick(a.data("data"))):(this._elements.removeClass("focus"),a.addClass("focus"),this._calculate(),this._displayTag(this._elements.index(a)),void(this._config.onFocus&&this._config.onFocus(a.data("data"))))},b.prototype.next=function(){var a=this._vp.find(".focus"),b=a.next(".element");b.size()>0?this._onElementClick(b):this._onElementClick(this._elements.first())},b.prototype.prev=function(){var a=this._vp.find(".focus"),b=a.prev(".element");b.size()>0?this._onElementClick(b):this._onElementClick(this._elements.last())},b.prototype.destroy=function(){this._elements.off("click.tdGal"),this._cont.replaceWith(this._original),this._original=null,this._vp=null,this._cont=null,this._clabel=null,this._labelOverflow=null,this._elements=null,this._templateElement=null,this._config=null,a(window).off("resize.tdGal")},b.prototype._onWinResize=function(){this._updateSizes(),this._calculate()},a.fn.tdGal=function(c,d){return this.each(function(){var e=a(this),f=a(this).data("__tdgal");if(("object"==typeof c||"undefined"==typeof c)&&!f)return c||(c={}),c.container=a(this),void e.data("__tdgal",new b(c));if("string"==typeof c&&f)switch(c.toLowerCase()){case"destroy":return e.data("__tdgal",null),void f.destroy();case"prev":return void f.prev();case"next":return void f.next();case"update":return void f.update();case"elements":return void f.setElements(d);default:throw Error("Cannot found method "+c)}throw new Error("Tdgal instance not found")})}}(jQuery);